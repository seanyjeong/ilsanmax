<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëª¨ì˜ê³ ì‚¬ ì„±ì  ì…ë ¥</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
  <style>
    body { max-width: 600px; margin: auto; font-size: 16px; }
    select, input { font-size: 1em; }
  </style>
</head>
<body>
  <h2>ğŸ“ ëª¨ì˜ê³ ì‚¬ ì„±ì  ì…ë ¥</h2>
  <form id="examForm">
    <label>í•™ìƒ ì„ íƒ
      <select name="student_id" id="studentSelect" required></select>
    </label>

    <label>ì‘ì‹œ ì›”
      <select name="exam_month" required>
        <option value="">-- ì„ íƒ --</option>
        <option value="3ì›”">3ì›”</option>
        <option value="6ì›”">6ì›”</option>
        <option value="9ì›”">9ì›”</option>
      </select>
    </label>

    <label>êµ­ì–´ ê³¼ëª©
      <select name="korean_subject" required>
        <option value="">-- ì„ íƒ --</option>
        <option value="ì–¸ì–´ì™€ë§¤ì²´">ì–¸ì–´ì™€ë§¤ì²´</option>
        <option value="í™”ë²•ê³¼ì‘ë¬¸">í™”ë²•ê³¼ì‘ë¬¸</option>
      </select>
    </label>
    <label>êµ­ì–´ ë°±ë¶„ìœ„ <input type="number" step="0.1" name="korean_percentile"></label>
    <label>êµ­ì–´ í‘œì¤€ì ìˆ˜ <input type="number" step="0.1" name="korean_standard_score"></label>
    <label>êµ­ì–´ ë“±ê¸‰ <input type="number" name="korean_grade" min="1" max="9"></label>

    <label>ìˆ˜í•™ ê³¼ëª©
      <select name="math_subject" required>
        <option value="">-- ì„ íƒ --</option>
        <option value="í™•ë¥ ê³¼í†µê³„">í™•ë¥ ê³¼í†µê³„</option>
        <option value="ë¯¸ì ë¶„">ë¯¸ì ë¶„</option>
        <option value="ê¸°í•˜">ê¸°í•˜</option>
      </select>
    </label>
    <label>ìˆ˜í•™ ë°±ë¶„ìœ„ <input type="number" step="0.1" name="math_percentile"></label>
    <label>ìˆ˜í•™ í‘œì¤€ì ìˆ˜ <input type="number" step="0.1" name="math_standard_score"></label>
    <label>ìˆ˜í•™ ë“±ê¸‰ <input type="number" name="math_grade" min="1" max="9"></label>

    <label>ì˜ì–´ ë“±ê¸‰ <input type="number" name="english_grade" min="1" max="9"></label>
    <label>í•œêµ­ì‚¬ ë“±ê¸‰ <input type="number" name="history_grade" min="1" max="9"></label>

    <label>íƒêµ¬1 ê³¼ëª©
      <select name="inquiry1_subject" id="inquiry1">
        <option value="">-- ì„ íƒ --</option>
      </select>
    </label>
    <label>íƒêµ¬1 ë°±ë¶„ìœ„ <input type="number" step="0.1" name="inquiry1_percentile"></label>
    <label>íƒêµ¬1 í‘œì¤€ì ìˆ˜ <input type="number" step="0.1" name="inquiry1_standard_score"></label>
    <label>íƒêµ¬1 ë“±ê¸‰ <input type="number" name="inquiry1_grade" min="1" max="9"></label>

    <label>íƒêµ¬2 ê³¼ëª©
      <select name="inquiry2_subject" id="inquiry2">
        <option value="">-- ì„ íƒ --</option>
      </select>
    </label>
    <label>íƒêµ¬2 ë°±ë¶„ìœ„ <input type="number" step="0.1" name="inquiry2_percentile"></label>
    <label>íƒêµ¬2 í‘œì¤€ì ìˆ˜ <input type="number" step="0.1" name="inquiry2_standard_score"></label>
    <label>íƒêµ¬2 ë“±ê¸‰ <input type="number" name="inquiry2_grade" min="1" max="9"></label>

    <button type="submit">ì €ì¥</button>
  </form>

  <script>
    const BASE_URL = 'https://supermax.kr/college';
    const subjects = [
      "ìƒí™œê³¼ìœ¤ë¦¬", "ìœ¤ë¦¬ì™€ì‚¬ìƒ", "í•œêµ­ì§€ë¦¬", "ì„¸ê³„ì§€ë¦¬", "ë™ì•„ì‹œì•„ì‚¬", "ì„¸ê³„ì‚¬",
      "ì •ì¹˜ì™€ë²•", "ê²½ì œ", "ì‚¬íšŒë¬¸í™”",
      "ë¬¼ë¦¬í•™I", "í™”í•™I", "ìƒëª…ê³¼í•™I", "ì§€êµ¬ê³¼í•™I",
      "ë¬¼ë¦¬í•™II", "í™”í•™II", "ìƒëª…ê³¼í•™II", "ì§€êµ¬ê³¼í•™II"
    ];

    function fillInquirySubjects() {
      const inquiry1 = document.getElementById('inquiry1');
      const inquiry2 = document.getElementById('inquiry2');
      subjects.forEach(subj => {
        inquiry1.innerHTML += `<option value="${subj}">${subj}</option>`;
        inquiry2.innerHTML += `<option value="${subj}">${subj}</option>`;
      });
    }

    async function loadStudents() {
      const res = await fetch(`${BASE_URL}/students`);
      const students = await res.json();
      const select = document.getElementById('studentSelect');
      students.forEach(s => {
        const option = document.createElement('option');
        option.value = s.id;
        option.textContent = `${s.name} (${s.school}, ${s.grade})`;
        select.appendChild(option);
      });
    }

    function sanitizePayload(data) {
      const sanitized = {};
      for (const key in data) {
        sanitized[key] = data[key] === '' ? null : data[key];
      }
      return sanitized;
    }

    document.getElementById('examForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      let payload = Object.fromEntries(formData.entries());

      // ìœ íš¨ì„± ê²€ì‚¬
      if (payload.inquiry1_subject && payload.inquiry1_subject === payload.inquiry2_subject) {
        alert('ğŸš« íƒêµ¬1ê³¼ íƒêµ¬2 ê³¼ëª©ì´ ë™ì¼í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ê³¼ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      payload = sanitizePayload(payload);

      console.log("ğŸ“¤ ì „ì†¡ ë°ì´í„°:", payload);

      const res = await fetch(`${BASE_URL}/submit-mock-exam`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const result = await res.json();
      alert(result.message || 'ì„±ì ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      e.target.reset();
    });

    fillInquirySubjects();
    loadStudents();
  </script>
</body>
</html>
